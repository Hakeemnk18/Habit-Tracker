<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Habit Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

    <style>
        :root {
            --primary-bg: #2b2b54;
            --nav-bg: #1a1a40;
            --chart-turquoise: #40E0D0;
            --chart-light-blue: #87CEEB;
            --chart-blue: #4169E1;
            --chart-purple: #9370DB;
            --text-yellow: #FFD700;
        }

        body {
            background-color: var(--primary-bg);
            color: white;
            min-height: 100vh;
        }

        .navbar {
            background: var(--nav-bg);
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .navbar-brand {
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
            padding: 0 1rem;
        }

        .main-content {
            padding: 2rem;
        }

        .habit-title {
            color: var(--text-yellow);
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }

        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            height: 400px; /* Increased height */
        }

        .add-habit-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 0.5rem 2rem;
            border-radius: 5px;
            margin-top: 1rem;
            float: right;
            margin-bottom: 10rem;
        }

        table {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            width: 100%;
            color: black;
            height: 400px;
        }

        th, td {
            padding: 0.5rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <span class="navbar-brand">Habit Tracker</span>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container main-content">
        <div class="row">
            <!-- First Chart and Table -->
            <div class="col-md-6">
                <h2 class="habit-title">• Habit 1</h2>
                <div class="chart-container">
                    <canvas id="habitChart1"></canvas>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if(goodHabit !== undefined && goodHabit.length > 0){ %>
                            <% goodHabit.forEach((item)=>{ %>
                                <tr>
                                    <td><%= item.name %></td>
                                    <td>1</td>
                                    <td>2</td>
                                    <td>3</td>
                                    <td>4</td>
                                    <td>5</td>
                                    <td><i class="fas fa-trash"></i></td>
                                    
                                    <td><a href="/editHabit?id=<%= item._id %>&type=good" style="text-decoration: none;color: inherit;"><i class="fas fa-pen"></i></a></i></td>
                                </tr>
                            <% }) %>

                        <% } %>
                        
                    </tbody>
                </table>
            </div>

            <!-- Second Chart and Table -->
            <div class="col-md-6">
                <h2 class="habit-title">• Habit 2</h2>
                <div class="chart-container">
                    <canvas id="habitChart2"></canvas>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if(badHabit !== undefined && badHabit.length > 0){ %>
                            <% badHabit.forEach((item)=>{ %>
                                <tr>
                                    <td><%= item.name %></td>
                                    <td>1</td>
                                    <td>2</td>
                                    <td>3</td>
                                    <td>4</td>
                                    <td>5</td>
                                    <td><i class="fas fa-trash"></i></td>
                                    <td></td>
                                </tr>
                            <% }) %>
                        <% } %>
                        
                        
                    </tbody>
                </table>
            </div>
        </div>
        <button class="add-habit-btn"><a href="/addHabit" style="text-decoration: none;color: inherit;">Add Habit</a></button>
    </div>

    <script>
        const badHabitData = <%- JSON.stringify(badHabit) %>;

        
        const badHabitNames = badHabitData.map(habit => habit.name);
        const badHabitCounts = badHabitData.map(habit => habit.count);
        console.log(badHabitCounts)
        console.log(badHabitNames)

        const goodHabitData = <%- JSON.stringify(goodHabit) %>;
        const goodHabitNames = goodHabitData.map(habit => habit.name)
        const goodHabitCounts = goodHabitData.map(habit => habit.count)
        

        const badChartConfig = {
        type: 'bar',
        data: {
            labels: badHabitNames,
            datasets: [{
                data: badHabitCounts, // Example data
                backgroundColor: [
                    '#87CEEB',
                    '#40E0D0',
                    '#4169E1',
                    '#4169E1',
                    '#9370DB'
                ],
                borderRadius: 5,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: { enabled: false },
                datalabels: {
                    anchor: 'end', // Place on top
                    align: 'end',  // Align top of bar
                    color: '#000',
                    font: {
                        weight: 'bold',
                        size: 14
                    },
                    padding: { top: 5 },
                    clip: false // Ensures labels stay visible outside the chart
                }
            },
            layout: {
                padding: {
                    top: 30 // Increase padding to make space for top labels
                }
            },
            scales: {
                x: {
                    grid: { display: false },
                    ticks: { color: '#000' }
                },
                y: {
                    // beginAtZero: true,
                    // ticks: { color: '#000' },
                    display:false

                }
            }
        },
        plugins: [ChartDataLabels] // Ensure this plugin is active
    };


    new Chart(document.getElementById('habitChart1').getContext('2d'), badChartConfig);

    const goodChartConfig = {
        type: 'bar',
        data: {
            labels: goodHabitNames,
            datasets: [{
                data: goodHabitCounts, // Example data
                backgroundColor: [
                    '#87CEEB',
                    '#40E0D0',
                    '#4169E1',
                    '#4169E1',
                    '#9370DB'
                ],
                borderRadius: 5,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: { enabled: false },
                datalabels: {
                    anchor: 'end', // Place on top
                    align: 'end',  // Align top of bar
                    color: '#000',
                    font: {
                        weight: 'bold',
                        size: 14
                    },
                    padding: { top: 5 },
                    clip: false // Ensures labels stay visible outside the chart
                }
            },
            layout: {
                padding: {
                    top: 30 // Increase padding to make space for top labels
                }
            },
            scales: {
                x: {
                    grid: { display: false },
                    ticks: { color: '#000' }
                },
                y: {
                    // beginAtZero: true,
                    // ticks: { color: '#000' },
                    display:false

                }
            }
        },
        plugins: [ChartDataLabels] // Ensure this plugin is active
    };
    new Chart(document.getElementById('habitChart2').getContext('2d'), goodChartConfig);
    //<a href="/editHabit" style="text-decoration: none;color: inherit;"><i class="fas fa-pen"></i></a>

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
